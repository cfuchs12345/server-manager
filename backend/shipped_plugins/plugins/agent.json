{
  "id": "agent",
  "name": "Agent",
  "description": "Can communicate with Agents via Apache Kafka",
  "server_icon": "<svg fill=\"#000000\" height=\"25px\" width=\"25px\" version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 512 512\" xml:space=\"preserve\"><g id=\"SVGRepo_bgCarrier\" stroke-width=\"0\"/><g id=\"SVGRepo_tracerCarrier\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><g id=\"SVGRepo_iconCarrier\"> <g> <g> <path d=\"M485.085,478.302l-25.6-76.8C456.003,391.049,446.216,384,435.199,384H412.62l19.874-39.748 c3.968-7.936,3.541-17.357-1.118-24.909c-4.668-7.552-12.902-12.143-21.777-12.143h-22.485 c3.763-13.099,6.443-26.795,7.851-41.114c26.428-12.672,40.235-32.947,40.235-61.286c0-3.371-0.384-6.502-0.93-9.54 c16.017-10.487,26.53-23.987,26.53-41.66c0-32.939-35.917-51.576-77.739-62.31C380.159,46.054,368.076,0,317.439,0 c-36.591,0-48.213,24.218-53.803,35.857c-1.058,2.21-2.637,5.495-3.507,6.562c-0.008-0.009-0.043-0.009-0.085-0.009 c-0.333,0-1.638,0.256-4.045,0.256c-3.362,0-4.574-0.503-4.582-0.512c-0.265-0.478-1.946-3.985-3.055-6.306 C242.772,24.218,231.15,0,194.559,0c-50.645,0-62.729,46.063-65.621,91.307C87.124,102.05,51.199,120.661,51.199,153.6 c0,17.715,10.556,31.232,26.624,41.728c-0.503,3.055-1.024,6.11-1.024,9.472c0,28.117,13.594,48.299,39.612,60.996 c1.425,14.413,4.25,28.203,8.047,41.404h-22.059c-8.875,0-17.109,4.591-21.777,12.143s-5.086,16.973-1.118,24.909L99.378,384 H76.799c-11.017,0-20.804,7.049-24.286,17.502l-25.6,76.8c-2.603,7.808-1.289,16.384,3.516,23.066 C35.242,508.041,42.973,512,51.199,512h409.6c8.226,0,15.957-3.959,20.77-10.633C486.382,494.694,487.688,486.11,485.085,478.302z M307.199,256c-13.158,0-16.87-13.372-22.246-26.419c32.87-1.647,85.205-6.775,124.365-21.905 C406.373,255.872,332.287,256,307.199,256z M368.298,275.319c-1.715,11.17-4.344,21.76-7.697,31.881h-66.202 c-10.667,0-20.224,6.622-23.97,16.614l-14.43,38.477l-14.43-38.477c-3.746-9.993-13.295-16.614-23.97-16.614h-66.287 c-3.294-10.129-5.768-20.736-7.484-31.846c17.161,4.019,37.257,6.246,60.971,6.246c30.063,0,38.4-27.153,41.958-38.741 c1.203-3.934,3.226-10.505,4.727-11.921c0.043,0,1.28-0.538,4.523-0.538c1.101,0,1.545,0.137,1.553,0.137 c1.229,1.246,3.925,8.252,5.53,12.433c4.813,12.535,14.857,38.63,44.109,38.63C330.973,281.6,351.112,279.356,368.298,275.319z M194.559,25.6c40.96,0,20.48,42.667,61.44,42.667s20.48-42.667,61.44-42.667c40.96,0,40.96,55.185,40.96,106.667 c0,0-40.96,21.333-102.4,21.333s-102.4-21.333-102.4-21.333C153.599,82.261,153.599,25.6,194.559,25.6z M76.799,153.6 c0-13.943,19.61-26.547,51.26-35.78c-0.043,4.958-0.06,9.83-0.06,14.447c0,9.54,5.308,18.295,13.773,22.707 c1.903,0.99,47.292,24.226,114.227,24.226s112.324-23.236,114.227-24.226c8.465-4.412,13.773-13.167,13.773-22.707 c0-4.617-0.017-9.498-0.06-14.455c31.659,9.225,51.26,21.845,51.26,35.789c0,28.279-80.23,51.2-179.2,51.2 S76.799,181.879,76.799,153.6z M102.672,207.676c38.246,14.78,88.951,20.002,121.941,21.76 c-4.651,13.09-6.605,26.564-19.814,26.564C179.711,256,105.625,255.872,102.672,207.676z M51.199,486.4l25.6-76.8h64l-38.4-76.8 h115.2l38.4,102.4l38.4-102.4h115.2l-38.4,76.8h64l25.6,76.8H51.199z\"/> </g> </g> </g></svg>",
  "detection": {
    "list": [
      {
        "params": [
          {
            "name": "kafka",
            "param_type": "boolean",
            "default_value": "true"
          },
          {
            "name": "topic",
            "param_type": "string",
            "default_value": "registered_agents"
          }
        ]
      }
    ],
    "detection_possible": true
  },
  "credentials": [],
  "params": [
    {
      "name": "topic",
      "param_type": "string",
      "default_value": "agent_commands"
    },
    {
      "name": "response_topic",
      "param_type": "string",
      "default_value": "agent_responses"
    },
    {
      "name": "error_topic",
      "param_type": "string",
      "default_value": "agent_errors"
    }
  ],
  "data": [
    {
      "id": "os-information",
      "description": "Get the type of the Operaring System where the agent is running",
      "output": true,
      "icon": "",
      "command": "kafka",
      "args": [
        {
          "name": "topic",
          "value": "agent_request"
        },
        {
          "name": "command",
          "value": "os-information"
        }
      ]
    }
  ],
  "actions": [
    {
      "id": "upgrade",
      "name": "Send APT Upgrade command",
      "show_on_main": true,
      "needs_confirmation": true,
      "available_for_state": "Active",
      "depends": [
        {
          "data_id": "os-information",
          "script": {
            "script_type": "lua",
            "script": "string.find(input, 'debian', 1, true) or string.find(input, 'ubuntu', 1, true)"
          }
        }
      ],
      "description": "Send Command to Agent",
      "command": "kafka",
      "args": [
        {
          "name": "command",
          "value": "apt upgrade -y"
        }
      ]
    },
    {
      "id": "dummy",
      "name": "Dummy command",
      "show_on_main": true,
      "needs_confirmation": true,
      "available_for_state": "Active",
      "icon": "<svg fill=\"#000000\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"25px\" height=\"25px\" viewBox=\"0 0 420.827 420.827\" xml:space=\"preserve\"><g id=\"SVGRepo_bgCarrier\" stroke-width=\"0\"/><g id=\"SVGRepo_tracerCarrier\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><g id=\"SVGRepo_iconCarrier\"> <g> <g> <path d=\"M210.29,0C156,0,104.43,20.693,65.077,58.269C25.859,95.715,2.794,146.022,0.134,199.921 c-0.135,2.734,0.857,5.404,2.744,7.388c1.889,1.983,4.507,3.105,7.244,3.105h45.211c5.275,0,9.644-4.098,9.979-9.362 c4.871-76.214,68.553-135.914,144.979-135.914c80.105,0,145.275,65.171,145.275,145.276c0,80.105-65.17,145.276-145.275,145.276 c-18.109,0-35.772-3.287-52.501-9.771l17.366-15.425c2.686-2.354,3.912-5.964,3.217-9.468c-0.696-3.506-3.209-6.371-6.592-7.521 l-113-32.552c-3.387-1.149-7.122-0.407-9.81,1.948c-2.686,2.354-3.913,5.963-3.218,9.467L69.71,403.157 c0.696,3.505,3.209,6.372,6.591,7.521c3.383,1.147,7.122,0.408,9.81-1.946l18.599-16.298 c31.946,18.574,68.456,28.394,105.581,28.394c116.021,0,210.414-94.392,210.414-210.414C420.705,94.391,326.312,0,210.29,0z\"/> <path d=\"M195.112,237.9h118.5c2.757,0,5-2.242,5-5v-30c0-2.757-2.243-5-5-5h-83.5v-91c0-2.757-2.243-5-5-5h-30 c-2.757,0-5,2.243-5,5v126C190.112,235.658,192.355,237.9,195.112,237.9z\"/> </g> </g> </g></svg>",
      "depends": [        
      ],
      "description": "Send Command to Agent",
      "command": "kafka",
      "args": [        
        {
          "name": "command",
          "value": "dir"
        }
      ]
    }
  ]
}
